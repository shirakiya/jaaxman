<source>
  @type tail
  format ltsv
  time_format %d/%b/%Y:%H:%M:%S %z
  path /var/log/nginx/jaaxman/access.log
  state_file /var/log/nginx/jaaxman/access_log.state
  tag jaaxman.nginx.access
</source>

<source>
  @type tail
  format none
  path /var/log/nginx/jaaxman/error.log
  state_file /var/log/nginx/jaaxman/error_log.state
  tag jaaxman.nginx.error
</source>

<source>
  @type tail
  format none
  path /var/log/uwsgi/jaaxman.log
  state_file /var/log/uwsgi/jaaxman_log.state
  tag jaaxman.app
</source>


<filter jaaxman.nginx.access>
  @type grep
  <exclude>
    key uri
    pattern ^\/healthcheck$
  </exclude>
</filter>

<filter jaaxman.app>
  @type grep
  <exclude>
    key message
    pattern GET \/healthcheck
  </exclude>
</filter>


<match jaaxman.nginx.access>
  @type cloudwatch_logs
  log_group_name jaaxman
  log_stream_name access_log
  auto_create_stream true
  include_time_key true
  localtime true
</match>

<match jaaxman.nginx.error>
  @type cloudwatch_logs
  log_group_name jaaxman
  log_stream_name error_log
  auto_create_stream true
  include_time_key true
  localtime true
</match>

<match jaaxman.app>
  @type cloudwatch_logs
  log_group_name jaaxman
  log_stream_name app_log
  auto_create_stream true
  include_time_key true
  localtime true
</match>

<match **>
  @type stdout
</match>
